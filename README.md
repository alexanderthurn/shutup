# Shutup App - Make your room silent!


## Short summary

This HTML5 app uses your microphone to detect if it is too loud in your room.
If the volume exceeds a defined limit, a sine alarm is played to make clear that the volume is too high.
As "too high" depends on the user, this value can be changed in realtime. Hint: The alarm sound itself can be louder than the allowed volume, which causes no problems at all. It is extracted by a notch filter, preventing a never ending alarm.

## Demo
You can try the app  [here](https://shutup.froso.de). Make sure to use a modern browser supporting the WebAudioApi and the Canvas element.

## List of technologies

* [HTML5 WebAudio Api](https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API) for audio stuff
* [HTML Canvas](https://developer.mozilla.org/en-US/docs/Glossary/Canvas) to display results
* Build/Compression via [Webpack 2](https://webpack.js.org/)

## How does the app work?

1. First it tries to access the microphone via the WebAudioApi and starts recording.
```javascript
navigator.getUserMedia({audio: true}, function (stream) {
     // start recording
});

```

2. If the volume exceeds a defined limit, it will activate the alarm.
```javascript

var tooLoud = currentValue > canvasHistorySelectedValue
if (tooLoud) {
     //play alarm
}
```

3. The alarm is generated by a sine oscillator, increasing its volume over time when the volume is too high.

```javascript
var oscillator = audioCtx.createOscillator()
oscillator.type = 'sine'
oscillator.frequency.value = sineFrequency // value in hertz

```

4. The sine tone itself can be louder than the allowed volume, which would normally result in a never ending alarm. But: A sine tone can be removed from the microphone input as we know the sine frequency. In order to do that we use a [biquad notch](https://developer.mozilla.org/en-US/docs/Web/API/BiquadFilterNode) filter.
```javascript

var biquadFilter = audioCtxMic.createBiquadFilter()
biquadFilter.type = "notch"
biquadFilter.frequency.value = sineFrequency
biquadFilter.Q.value = 0.01
```

5. To give visual feedback to the user, we render a canvas with a volume/time graph.
```javascript
// listenToMic, display volume over time on canvas
updateCanvasRegular = function () {
     setTimeout(function () {
        // render
     }, 30)
 }

```

## Known issues

* Right now I am not too sure about the unit of the volume. It could be "db" but I just multiplied the value with a constant to get a good "0..1" range
* The rendering can be highly optimized
* A UX Designer could improve the UI ;-)

## License

Licensed under MIT

Copyright (c) 2017 [Alexander Thurn](https://github.com/alexanderthurn)
